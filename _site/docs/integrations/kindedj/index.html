<h2 id="kindedj">KindedJ</h2>

<p><a href="https://github.com/KindedJ/KindedJ/">KindedJ</a> is a project to create an interop layer between multiple libraries that emulate <a href="/docs/patterns/glossary">higher kinds</a> in the JVM
using lightweight higher kind polymorphisms. You can read more about this emulation in <a href="https://github.com/KindedJ/KindedJ/blob/master/README.md">KindedJ’s Readme</a>.</p>

<h3 id="generation-of-kindedj-interfaces">Generation of KindedJ interfaces</h3>

<p>Annotating a <a href="/docs/patterns/glossary">datatype</a> with <code class="highlighter-rouge">@higherkind</code> will create a typealias <code class="highlighter-rouge">&lt;datatype&gt;KindedJ</code> that’ll be directly available to be used by any other libraries that use <a href="https://github.com/KindedJ/KindedJ/">KindedJ</a>.
Due to the difference in <a href="https://kotlinlang.org/docs/reference/generics.html">generics between Kotlin and Java</a> this typealias will only be generated if all the generic parameters of the datatype are invariant.</p>

<p>To work with datatypes whose generic parameters are not invariant requires a conversion layer.</p>

<h3 id="conversion-module">Conversion module</h3>

<p>The arrow-kindedj module provides a conversion layer between Arrow and KindedJ where the kotlin generics <code class="highlighter-rouge">in</code> and <code class="highlighter-rouge">out</code> get on the way.</p>

<p>It uses an integration construct called <code class="highlighter-rouge">Convert</code>, alongside several extension functions.</p>

<h4 id="using-kindedj-in-arrow-from-kotlin">Using KindedJ in Arrow from Kotlin</h4>

<p>Using the conversion layer we’re capable of using an intermediate representation of any KindedJ datatype generically by converting it into a <code class="highlighter-rouge">Kind2&lt;ForConvert, F, A&gt;</code>,
where F is the <a href="/docs/patterns/glossary">original representation of the container</a>.</p>

<p>Let’s see an example of a Java class defined by a third party:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">IdJ</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="n">io</span><span class="o">.</span><span class="na">kindedj</span><span class="o">.</span><span class="na">Hk</span><span class="o">&lt;</span><span class="n">ForIdJ</span><span class="o">,</span> <span class="n">A</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="n">A</span> <span class="n">a</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>You can convert it to Arrow using the extension function <code class="highlighter-rouge">fromKindedJ()</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">idj</span> <span class="p">=</span> <span class="n">IdJ</span><span class="p">(</span><span class="m">1</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">Kind2</span><span class="p">&lt;</span><span class="n">ForConvert</span><span class="p">,</span> <span class="n">ForIdJ</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">idj</span><span class="p">.</span><span class="n">fromKindedJ</span><span class="p">()</span>
</code></pre></div></div>

<p>and convert it back using <code class="highlighter-rouge">fromArrow()</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">idj2</span><span class="p">:</span> <span class="n">io</span><span class="p">.</span><span class="n">kindedj</span><span class="p">.</span><span class="n">Hk</span><span class="p">&lt;</span><span class="n">ForIdJ</span><span class="p">,</span> <span class="n">A</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">id</span><span class="p">.</span><span class="n">fromArrow</span><span class="p">()</span>
</code></pre></div></div>

<h4 id="using-arrow-in-kindedj-from-java">Using Arrow in KindedJ from Java</h4>

<p>Using the conversion layer we’re capable of using an intermediate representation of any Arrow datatype generically by converting it into a <code class="highlighter-rouge">io.kindedj.Hk2&lt;ForConvert, F, A&gt;</code>,
where F is the <a href="/docs/patterns/glossary">original representation of the container</a>. Note that the typealias <code class="highlighter-rouge">io.kindedj.Hk2</code> is only available in Kotlin.</p>

<p>Let’s see an example using our type <a href="/docs/datatypes/id"><code class="highlighter-rouge">Id</code></a>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">IdK</span><span class="p">&lt;</span><span class="k">out</span> <span class="n">A</span><span class="p">&gt;(</span><span class="kd">val</span> <span class="py">a</span><span class="p">:</span> <span class="n">A</span><span class="p">)</span>
</code></pre></div></div>

<p>You can convert it to Arrow using the conversion class <code class="highlighter-rouge">Convert.FromArrowToKindedJ</code> and its static factory <code class="highlighter-rouge">Convert.toKindedJ()</code>:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">IdK</span> <span class="n">idk</span> <span class="o">=</span> <span class="k">new</span> <span class="n">IdK</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

<span class="n">Convert</span><span class="o">.</span><span class="na">FromArrowToKindedJ</span><span class="o">&lt;</span><span class="n">ForIdJ</span><span class="o">,</span> <span class="n">A</span><span class="o">&gt;</span> <span class="n">idj</span> <span class="o">=</span> <span class="n">Convert</span><span class="o">.</span><span class="na">toKindedJ</span><span class="o">(</span><span class="n">idk</span><span class="o">);</span>
</code></pre></div></div>

<p>and convert it back using <code class="highlighter-rouge">FromArrowToKindedJ.toArrow()</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>IdJ idk2 = idj.toArrow();
</code></pre></div></div>

<h4 id="how-to-work-with-the-conversion-layer">How to work with the conversion layer</h4>

<p>It is important to understand that the integration with KindedJ works at a level of genericity where values inside one of the intermediate representations cannot be accessed directly.
It’s required to use the constructs inside Arrow or the 3rd party lib implementing KindedJ to be able to use functions like <code class="highlighter-rouge">map</code> or <code class="highlighter-rouge">flatMap</code>.</p>

<p>Further integration in KindedJ of constructs such as <a href="/docs/patterns/glossary">typeclasses</a> is in the KindedJ org’s roadmap.</p>
