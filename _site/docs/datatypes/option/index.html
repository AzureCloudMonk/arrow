<h2 id="option">Option</h2>

<p>If you have worked with Java at all in the past, it is very likely that you have come across a <code class="highlighter-rouge">NullPointerException</code> at some time (other languages will throw similarly named errors in such a case). Usually this happens because some method returns <code class="highlighter-rouge">null</code> when you were not expecting it and thus not dealing with that possibility in your client code. A value of <code class="highlighter-rouge">null</code> is often abused to represent an absent optional value.
Kotlin tries to solve the problem by getting rid of <code class="highlighter-rouge">null</code> values altogether and providing its own special syntax <a href="https://kotlinlang.org/docs/reference/null-safety.html">Null-safety machinery based on <code class="highlighter-rouge">?</code></a>.</p>

<p>Arrow models the absence of values through the <code class="highlighter-rouge">Option</code> datatype similar to how Scala, Haskell and other FP languages handle optional values.</p>

<p><code class="highlighter-rouge">Option&lt;A&gt;</code> is a container for an optional value of type <code class="highlighter-rouge">A</code>. If the value of type <code class="highlighter-rouge">A</code> is present, the <code class="highlighter-rouge">Option&lt;A&gt;</code> is an instance of <code class="highlighter-rouge">Some&lt;A&gt;</code>, containing the present value of type <code class="highlighter-rouge">A</code>. If the value is absent, the <code class="highlighter-rouge">Option&lt;A&gt;</code> is the object <code class="highlighter-rouge">None</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.*</span>
<span class="k">import</span> <span class="nn">arrow.core.*</span>

<span class="kd">val</span> <span class="py">someValue</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="s">"I am wrapped in something"</span><span class="p">)</span>
<span class="n">someValue</span>
<span class="c1">// Some(I am wrapped in something)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">emptyValue</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">None</span>
<span class="n">emptyValue</span>
<span class="c1">// None</span>
</code></pre></div></div>

<p>Letâ€™s write a function that may or not give us a string, thus returning <code class="highlighter-rouge">Option&lt;String&gt;</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="n">maybeItWillReturnSomething</span><span class="p">(</span><span class="n">flag</span><span class="p">:</span> <span class="n">Boolean</span><span class="p">):</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span> <span class="n">Some</span><span class="p">(</span><span class="s">"Found value"</span><span class="p">)</span> <span class="k">else</span> <span class="n">None</span>
</code></pre></div></div>

<p>Using <code class="highlighter-rouge">getOrElse</code> we can provide a default value <code class="highlighter-rouge">"No value"</code> when the optional argument <code class="highlighter-rouge">None</code> does not exist:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">value1</span> <span class="p">=</span> <span class="n">maybeItWillReturnSomething</span><span class="p">(</span><span class="k">true</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">value2</span> <span class="p">=</span> <span class="n">maybeItWillReturnSomething</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value1</span><span class="p">.</span><span class="n">getOrElse</span> <span class="p">{</span> <span class="s">"No value"</span> <span class="p">}</span>
<span class="c1">// Found value</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value2</span><span class="p">.</span><span class="n">getOrElse</span> <span class="p">{</span> <span class="s">"No value"</span> <span class="p">}</span>
<span class="c1">// No value</span>
</code></pre></div></div>

<p>Checking whether option has value:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value1</span> <span class="k">is</span> <span class="n">None</span>
<span class="c1">// false</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">value2</span> <span class="k">is</span> <span class="n">None</span>
<span class="c1">// true</span>
</code></pre></div></div>

<p>Option can also be used with when statements:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">someValue</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">20.0</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="k">when</span><span class="p">(</span><span class="n">someValue</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">is</span> <span class="n">Some</span> <span class="p">-&gt;</span> <span class="n">someValue</span><span class="p">.</span><span class="n">t</span>
   <span class="k">is</span> <span class="n">None</span> <span class="p">-&gt;</span> <span class="m">0.0</span>
<span class="p">}</span>
<span class="n">value</span>
<span class="c1">// 20.0</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">noValue</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Double</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">None</span>
<span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="k">when</span><span class="p">(</span><span class="n">noValue</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">is</span> <span class="n">Some</span> <span class="p">-&gt;</span> <span class="n">noValue</span><span class="p">.</span><span class="n">t</span>
   <span class="k">is</span> <span class="n">None</span> <span class="p">-&gt;</span> <span class="m">0.0</span>
<span class="p">}</span>
<span class="n">value</span>
<span class="c1">// 0.0</span>
</code></pre></div></div>

<p>An alternative for pattern matching is performing Functor/Foldable style operations. This is possible because an option could be looked at as a collection or foldable structure with either one or zero elements.</p>

<p>One of these operations is <code class="highlighter-rouge">map</code>. This operation allows us to map the inner value to a different type while preserving the option:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">number</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">3</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">noNumber</span><span class="p">:</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">None</span>
<span class="kd">val</span> <span class="py">mappedResult1</span> <span class="p">=</span> <span class="n">number</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="m">1.5</span> <span class="p">}</span>
<span class="kd">val</span> <span class="py">mappedResult2</span> <span class="p">=</span> <span class="n">noNumber</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="m">1.5</span> <span class="p">}</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mappedResult1</span>
<span class="c1">// Some(4.5)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mappedResult2</span>
<span class="c1">// None</span>
</code></pre></div></div>

<p>Another operation is <code class="highlighter-rouge">fold</code>. This operation will extract the value from the option, or provide a default if the value is <code class="highlighter-rouge">None</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">number</span><span class="p">.</span><span class="n">fold</span><span class="p">({</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="m">3</span> <span class="p">})</span>
<span class="c1">// 9</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">noNumber</span><span class="p">.</span><span class="n">fold</span><span class="p">({</span> <span class="m">1</span> <span class="p">},</span> <span class="p">{</span> <span class="n">it</span> <span class="p">*</span> <span class="m">3</span> <span class="p">})</span>
<span class="c1">// 1</span>
</code></pre></div></div>

<p>Arrow also adds syntax to all datatypes so you can easily lift them into the context of <code class="highlighter-rouge">Option</code> where needed.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">1</span><span class="p">.</span><span class="n">some</span><span class="p">()</span>
<span class="c1">// Some(1)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">none</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;()</span>
<span class="c1">// None</span>
</code></pre></div></div>

<p>Arrow contains <code class="highlighter-rouge">Option</code> instances for many useful typeclasses that allows you to use and transform optional values</p>

<p><a href="/docs/typeclasses/functor/"><code class="highlighter-rouge">Functor</code></a></p>

<p>Transforming the inner contents</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.typeclasses.*</span>

<span class="n">Option</span><span class="p">.</span><span class="n">functor</span><span class="p">().</span><span class="n">run</span> <span class="p">{</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">map</span> <span class="p">{</span> <span class="n">it</span> <span class="p">+</span> <span class="m">1</span> <span class="p">}</span> <span class="p">}</span>
<span class="c1">// Some(2)</span>
</code></pre></div></div>

<p><a href="/docs/typeclasses/applicative/"><code class="highlighter-rouge">Applicative</code></a></p>

<p>Computing over independent values</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Option</span><span class="p">.</span><span class="n">applicative</span><span class="p">().</span><span class="n">tupled</span><span class="p">(</span><span class="n">Some</span><span class="p">(</span><span class="m">1</span><span class="p">),</span> <span class="n">Some</span><span class="p">(</span><span class="s">"Hello"</span><span class="p">),</span> <span class="n">Some</span><span class="p">(</span><span class="m">20.0</span><span class="p">))</span>
<span class="c1">// Some(Tuple3(a=1, b=Hello, c=20.0))</span>
</code></pre></div></div>

<p><a href="/docs/typeclasses/monad/"><code class="highlighter-rouge">Monad</code></a></p>

<p>Computing over dependent values ignoring absence</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">().</span><span class="n">binding</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">a</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
   <span class="kd">val</span> <span class="py">b</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">a</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
   <span class="kd">val</span> <span class="py">c</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">b</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
   <span class="n">a</span> <span class="p">+</span> <span class="n">b</span> <span class="p">+</span> <span class="n">c</span>
<span class="p">}</span>
<span class="c1">//Some(value=6)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">().</span><span class="n">binding</span> <span class="p">{</span>
   <span class="kd">val</span> <span class="py">x</span> <span class="p">=</span> <span class="n">none</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;().</span><span class="n">bind</span><span class="p">()</span>
   <span class="kd">val</span> <span class="py">y</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">x</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
   <span class="kd">val</span> <span class="py">z</span> <span class="p">=</span> <span class="n">Some</span><span class="p">(</span><span class="m">1</span> <span class="p">+</span> <span class="n">y</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
   <span class="n">x</span> <span class="p">+</span> <span class="n">y</span> <span class="p">+</span> <span class="n">z</span>
<span class="p">}</span>
<span class="c1">//None</span>
</code></pre></div></div>

<h2 id="available-instances">Available Instances:</h2>

<ul>
  <li><a href="/docs/typeclasses/show">Show</a></li>
  <li><a href="/docs/typeclasses/eq">Eq</a></li>
  <li><a href="/docs/typeclasses/applicative">Applicative</a></li>
  <li><a href="/docs/typeclasses/applicativeerror">ApplicativeError</a></li>
  <li><a href="/docs/typeclasses/foldable">Foldable</a></li>
  <li><a href="/docs/typeclasses/functor">Functor</a></li>
  <li><a href="/docs/typeclasses/monad">Monad</a></li>
  <li><a href="/docs/typeclasses/monaderror">MonadError</a></li>
  <li><a href="/docs/typeclasses/monadfilter">MonadFilter</a></li>
  <li><a href="/docs/typeclasses/traverse">Traverse</a></li>
  <li><a href="/docs/typeclasses/traversefilter">TraverseFilter</a></li>
  <li><a href="/docs/optics/each">Each</a></li>
</ul>

<h2 id="credits">Credits</h2>

<p>Contents partially adapted from <a href="https://www.scala-exercises.org/std_lib/options">Scala Exercises Option Tutorial</a>
Originally based on the Scala Koans.</p>
