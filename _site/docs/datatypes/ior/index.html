<h2 id="ior">Ior</h2>

<p><code class="highlighter-rouge">Ior</code> represents an inclusive-or relationship between two data types.
This makes it very similar to the <a href="/docs/datatypes/either"><code class="highlighter-rouge">Either</code></a> data type, which represents an “exclusive-or” relationship.
An <code class="highlighter-rouge">Ior&lt;A, B&gt;</code> (also written as <code class="highlighter-rouge">A Ior B</code>) can contain either an <code class="highlighter-rouge">A</code>, a <code class="highlighter-rouge">B</code>, or both.
Another similarity to <code class="highlighter-rouge">Either</code> is that <code class="highlighter-rouge">Ior</code> is right-biased,
which means that the <code class="highlighter-rouge">map</code> and <code class="highlighter-rouge">flatMap</code> functions will work on the right side of the <code class="highlighter-rouge">Ior</code>, in our case the <code class="highlighter-rouge">B</code> value.
You can see this in the function signature of <code class="highlighter-rouge">map</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="p">&lt;</span><span class="n">D</span><span class="p">&gt;</span> <span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">D</span><span class="p">):</span> <span class="n">Ior</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">D</span><span class="p">&gt;</span>
</code></pre></div></div>

<p>We can create <code class="highlighter-rouge">Ior</code> values using <code class="highlighter-rouge">Ior.Left</code>, <code class="highlighter-rouge">Ior.Right</code> and <code class="highlighter-rouge">Ior.Both</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.*</span>
<span class="k">import</span> <span class="nn">arrow.data.*</span>

<span class="n">Ior</span><span class="p">.</span><span class="n">Right</span><span class="p">(</span><span class="m">42</span><span class="p">)</span>
<span class="c1">// Right(value=42)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">Left</span><span class="p">(</span><span class="s">"Error"</span><span class="p">)</span>
<span class="c1">// Left(value=Error)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">Both</span><span class="p">(</span><span class="s">"Warning"</span><span class="p">,</span> <span class="m">41</span><span class="p">)</span>
<span class="c1">// Both(leftValue=Warning, rightValue=41)</span>
</code></pre></div></div>

<p>Arrow also offers extension functions for <code class="highlighter-rouge">Ior</code>, the <code class="highlighter-rouge">leftIor</code>, <code class="highlighter-rouge">rightIor</code> and <code class="highlighter-rouge">bothIor</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="m">3</span><span class="p">.</span><span class="n">rightIor</span><span class="p">()</span>
<span class="c1">// Right(value=3)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"Error"</span><span class="p">.</span><span class="n">leftIor</span><span class="p">()</span>
<span class="c1">// Left(value=Error)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="s">"Warning"</span> <span class="n">to</span> <span class="m">3</span><span class="p">).</span><span class="n">bothIor</span><span class="p">()</span>
<span class="c1">// Both(leftValue=Warning, rightValue=3)</span>
</code></pre></div></div>

<p>When we look at the <code class="highlighter-rouge">Monad</code> or <code class="highlighter-rouge">Applicative</code> instances of <code class="highlighter-rouge">Ior</code>, we can see that they actually require a <code class="highlighter-rouge">Semigroup</code> instance on the left side.
This is because <code class="highlighter-rouge">Ior</code> will actually accumulate failures on the left side, very similarly to how the <a href="/docs/datatypes/validated"><code class="highlighter-rouge">Validated</code></a> data type does.
This means we can accumulate data on the left side while also being able to short-circuit upon the first right-side-only value.
For example, we might want to accumulate warnings together with a valid result and only halt the computation on a “hard error”
Here’s an example of how we are able to do that:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">User</span><span class="p">(</span><span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="kd">val</span> <span class="py">pw</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>

<span class="k">fun</span> <span class="n">validateUsername</span><span class="p">(</span><span class="n">username</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
    <span class="n">username</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">()</span> <span class="p">-&gt;</span> <span class="n">Nel</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">"Can't be empty"</span><span class="p">).</span><span class="n">leftIor</span><span class="p">()</span>
    <span class="n">username</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="s">"."</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">Nel</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">"Dot in name is deprecated"</span><span class="p">)</span> <span class="n">to</span> <span class="n">username</span><span class="p">).</span><span class="n">bothIor</span><span class="p">()</span>
    <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">username</span><span class="p">.</span><span class="n">rightIor</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="n">validatePassword</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
    <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="p">&lt;</span> <span class="m">8</span> <span class="p">-&gt;</span> <span class="n">Nel</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">"Password too short"</span><span class="p">).</span><span class="n">leftIor</span><span class="p">()</span>
    <span class="n">password</span><span class="p">.</span><span class="n">length</span> <span class="p">&lt;</span> <span class="m">10</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">Nel</span><span class="p">.</span><span class="n">of</span><span class="p">(</span><span class="s">"Password should be longer"</span><span class="p">)</span> <span class="n">to</span> <span class="n">password</span><span class="p">).</span><span class="n">bothIor</span><span class="p">()</span>
    <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">password</span><span class="p">.</span><span class="n">rightIor</span><span class="p">()</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="n">validateUser</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">pass</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span>
        <span class="n">Ior</span><span class="p">.</span><span class="n">monad</span><span class="p">&lt;</span><span class="n">Nel</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;&gt;().</span><span class="n">binding</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">username</span> <span class="p">=</span> <span class="n">validateUsername</span><span class="p">(</span><span class="n">name</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
            <span class="kd">val</span> <span class="py">password</span> <span class="p">=</span> <span class="n">validatePassword</span><span class="p">(</span><span class="n">pass</span><span class="p">).</span><span class="n">bind</span><span class="p">()</span>
            <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="p">}.</span><span class="n">fix</span><span class="p">()</span>
</code></pre></div></div>

<p>Now we’re able to validate user data and also accumulate non-fatal warnings:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validateUser</span><span class="p">(</span><span class="s">"John"</span><span class="p">,</span> <span class="s">"password12"</span><span class="p">)</span>
<span class="c1">//Right(value=User(name=John, pw=password12))</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validateUser</span><span class="p">(</span><span class="s">"john.doe"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">)</span>
<span class="c1">//Both(leftValue=NonEmptyList(all=[Dot in name is deprecated, Password should be longer]), rightValue=User(name=john.doe, pw=password))</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validateUser</span><span class="p">(</span><span class="s">"jane"</span><span class="p">,</span> <span class="s">"short"</span><span class="p">)</span>
<span class="c1">//Left(value=NonEmptyList(all=[Password too short]))</span>
</code></pre></div></div>

<p>To extract the values, we can use the <code class="highlighter-rouge">fold</code> method, which expects a function for each case the <code class="highlighter-rouge">Ior</code> can represent:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">validateUser</span><span class="p">(</span><span class="s">"john.doe"</span><span class="p">,</span> <span class="s">"password"</span><span class="p">).</span><span class="n">fold</span><span class="p">(</span>
        <span class="p">{</span> <span class="s">"Error: ${it.head}"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s">"Success $it"</span> <span class="p">},</span>
        <span class="p">{</span> <span class="n">warnings</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="s">"Warning: $name; The following warnings occurred: ${warnings.show()}"</span> <span class="p">}</span>
<span class="p">)</span>
<span class="c1">//Warning: john.doe; The following warnings occurred: Dot in name is deprecated, Password should be longer</span>
</code></pre></div></div>
<p>Similar to <a href="/docs/datatypes/validated">Validated</a>, there is also a type alias for using a <code class="highlighter-rouge">NonEmptyList</code> on the left side.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typealias</span> <span class="n">IorNel</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Ior</span><span class="p">&lt;</span><span class="n">Nel</span><span class="p">&lt;</span><span class="n">A</span><span class="p">&gt;,</span> <span class="n">B</span><span class="p">&gt;</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">leftNel</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;(</span><span class="s">"Error"</span><span class="p">)</span>
<span class="c1">// Left(value=NonEmptyList(all=[Error]))</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">bothNel</span><span class="p">(</span><span class="s">"Warning"</span><span class="p">,</span> <span class="m">41</span><span class="p">)</span>
<span class="c1">// Both(leftValue=NonEmptyList(all=[Warning]), rightValue=41)</span>
</code></pre></div></div>

<p>We can also convert our <code class="highlighter-rouge">Ior</code> to <code class="highlighter-rouge">Either</code>, <code class="highlighter-rouge">Validated</code> or <code class="highlighter-rouge">Option</code>.
All of these conversions will discard the left side value if both are available:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">Both</span><span class="p">(</span><span class="s">"Warning"</span><span class="p">,</span> <span class="m">41</span><span class="p">).</span><span class="n">toEither</span><span class="p">()</span>
<span class="c1">// Right(b=41)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">Both</span><span class="p">(</span><span class="s">"Warning"</span><span class="p">,</span> <span class="m">41</span><span class="p">).</span><span class="n">toValidated</span><span class="p">()</span>
<span class="c1">// Valid(a=41)</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Ior</span><span class="p">.</span><span class="n">Both</span><span class="p">(</span><span class="s">"Warning"</span><span class="p">,</span> <span class="m">41</span><span class="p">).</span><span class="n">toOption</span><span class="p">()</span>
<span class="c1">// Some(41)</span>
</code></pre></div></div>

<h2 id="available-instances">Available Instances</h2>

<ul>
  <li><a href="/docs/typeclasses/show">Show</a></li>
  <li><a href="/docs/typeclasses/eq">Eq</a></li>
  <li><a href="/docs/typeclasses/foldable">Foldable</a></li>
  <li><a href="/docs/typeclasses/functor">Functor</a></li>
  <li><a href="/docs/typeclasses/traverse">Traverse</a></li>
  <li><a href="/docs/typeclasses/traversefilter">TraverseFilter</a></li>
</ul>

<h2 id="credits">Credits</h2>

<p>Contents partially adapted from <a href="https://typelevel.org/cats/datatypes/ior.html">Cats Ior</a></p>
