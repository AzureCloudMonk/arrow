<h2 id="kleisli">Kleisli</h2>
<p>Kleisli enables composition of functions that return a monadic value, for instance, an <code class="highlighter-rouge">Option&lt;Int&gt;</code> or an <code class="highlighter-rouge">Either&lt;String, Int&gt;</code>, without having functions take an <code class="highlighter-rouge">Option</code> or <code class="highlighter-rouge">Either</code> as a parameter.</p>

<p>For example, we have the function <code class="highlighter-rouge">String.toInt()</code> which can throw a <code class="highlighter-rouge">NumberFormatException</code> and we want to do a safe conversion like this:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.core.*</span>
<span class="k">import</span> <span class="nn">arrow.data.Kleisli</span>

<span class="kd">val</span> <span class="py">optionIntKleisli</span> <span class="p">=</span> <span class="n">Kleisli</span> <span class="p">{</span> <span class="n">str</span><span class="p">:</span> <span class="n">String</span> <span class="p">-&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toCharArray</span><span class="p">().</span><span class="n">all</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isDigit</span><span class="p">()</span> <span class="p">})</span> <span class="n">Some</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toInt</span><span class="p">())</span> <span class="k">else</span> <span class="n">None</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="n">String</span><span class="p">.</span><span class="n">safeToInt</span><span class="p">():</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="n">fix</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Then when we use the function we have an <code class="highlighter-rouge">Option&lt;Int&gt;</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"a"</span><span class="p">.</span><span class="n">safeToInt</span><span class="p">()</span>
<span class="c1">// None</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">"1"</span><span class="p">.</span><span class="n">safeToInt</span><span class="p">()</span>
<span class="c1">// Some(1)</span>
</code></pre></div></div>

<h2 id="functions">Functions</h2>

<h4 id="local">Local</h4>
<p>This function allows doing a conversion inside the Kleisli to the original input value before the Kleisli will be executed, creating a Kleisli with the input type of the conversion</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">local</span> <span class="p">{</span> <span class="n">optStr</span> <span class="p">:</span><span class="n">Option</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;</span> <span class="p">-&gt;</span> <span class="n">optStr</span><span class="p">.</span><span class="n">getOrElse</span> <span class="p">{</span> <span class="s">"0"</span> <span class="p">}</span> <span class="p">}.</span><span class="n">run</span><span class="p">(</span><span class="n">None</span><span class="p">)</span>
<span class="c1">// Some(0)</span>
</code></pre></div></div>

<h4 id="ap">Ap</h4>
<p>The <code class="highlighter-rouge">ap</code> function transform the <code class="highlighter-rouge">Kleisli</code> into another <code class="highlighter-rouge">Kleisli</code> with a function as a output value.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.data.fix</span>

<span class="kd">val</span> <span class="py">intToDouble</span> <span class="p">=</span> <span class="p">{</span><span class="n">number</span><span class="p">:</span><span class="n">Int</span> <span class="p">-&gt;</span> <span class="n">number</span><span class="p">.</span><span class="n">toDouble</span><span class="p">()}</span>

<span class="kd">val</span> <span class="py">optionIntDoubleKleisli</span> <span class="p">=</span> <span class="n">Kleisli</span> <span class="p">{</span> <span class="n">str</span><span class="p">:</span> <span class="n">String</span> <span class="p">-&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toCharArray</span><span class="p">().</span><span class="n">all</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isDigit</span><span class="p">()</span> <span class="p">})</span> <span class="n">Some</span><span class="p">(</span><span class="n">intToDouble</span><span class="p">)</span> <span class="k">else</span> <span class="n">None</span>
<span class="p">}</span>

<span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">ap</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">applicative</span><span class="p">(),</span> <span class="n">optionIntDoubleKleisli</span><span class="p">).</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(1.0)</span>
</code></pre></div></div>

<h4 id="map">Map</h4>
<p>The <code class="highlighter-rouge">map</code> function transform the <code class="highlighter-rouge">Kleisli</code> output value.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">applicative</span><span class="p">())</span> <span class="p">{</span> <span class="n">output</span> <span class="p">-&gt;</span> <span class="n">output</span> <span class="p">+</span> <span class="m">1</span> <span class="p">}.</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(2)</span>
</code></pre></div></div>

<h4 id="flatmap">FlatMap</h4>
<p><code class="highlighter-rouge">flatMap</code> is useful to map the <code class="highlighter-rouge">Kleisli</code> output into another kleisli</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.data.fix</span>

<span class="kd">val</span> <span class="py">optionDoubleKleisli</span> <span class="p">=</span> <span class="n">Kleisli</span> <span class="p">{</span> <span class="n">str</span><span class="p">:</span> <span class="n">String</span> <span class="p">-&gt;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toCharArray</span><span class="p">().</span><span class="n">all</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isDigit</span><span class="p">()</span> <span class="p">})</span> <span class="n">Some</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toDouble</span><span class="p">())</span> <span class="k">else</span> <span class="n">None</span>
<span class="p">}</span>

<span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">flatMap</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">(),</span> <span class="p">{</span> <span class="n">optionDoubleKleisli</span> <span class="p">}).</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(1.0)</span>
</code></pre></div></div>

<h4 id="andthen">AndThen</h4>
<p>You can use <code class="highlighter-rouge">andThen</code> to compose with another kleisli</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.data.fix</span>

<span class="kd">val</span> <span class="py">optionFromOptionKleisli</span> <span class="p">=</span> <span class="n">Kleisli</span> <span class="p">{</span> <span class="n">number</span><span class="p">:</span> <span class="n">Int</span> <span class="p">-&gt;</span>
   <span class="n">Some</span><span class="p">(</span><span class="n">number</span><span class="p">+</span><span class="m">1</span><span class="p">)</span>
<span class="p">}</span>

<span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">(),</span> <span class="n">optionFromOptionKleisli</span><span class="p">).</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(2)</span>
</code></pre></div></div>

<p>with another function</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">(),</span> <span class="p">{</span> <span class="n">number</span><span class="p">:</span> <span class="n">Int</span> <span class="p">-&gt;</span> <span class="n">Some</span><span class="p">(</span><span class="n">number</span><span class="p">+</span><span class="m">1</span><span class="p">)</span> <span class="p">}).</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(2)</span>
</code></pre></div></div>

<p>or to replace the <code class="highlighter-rouge">Kleisli</code> result</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">optionIntKleisli</span><span class="p">.</span><span class="n">andThen</span><span class="p">(</span><span class="n">Option</span><span class="p">.</span><span class="n">monad</span><span class="p">(),</span> <span class="n">Some</span><span class="p">(</span><span class="m">0</span><span class="p">)).</span><span class="n">fix</span><span class="p">().</span><span class="n">run</span><span class="p">(</span><span class="s">"1"</span><span class="p">)</span>
<span class="c1">// Some(0)</span>
</code></pre></div></div>

<h2 id="available-instances">Available Instances</h2>

<ul>
  <li><a href="/docs/typeclasses/applicative">Applicative</a></li>
  <li><a href="/docs/typeclasses/applicativeerror">ApplicativeError</a></li>
  <li><a href="/docs/typeclasses/functor">Functor</a></li>
  <li><a href="/docs/typeclasses/monad">Monad</a></li>
  <li><a href="/docs/typeclasses/monaderror">MonadError</a></li>
</ul>
