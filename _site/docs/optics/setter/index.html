<h2 id="setter">Setter</h2>

<p>A <code class="highlighter-rouge">Setter</code> is an optic that can see into a structure and set or modify its focus.</p>

<p>It is a generalisation of <a href="/docs/typeclasses/functor"><code class="highlighter-rouge">Functor#map</code></a>. Given a <code class="highlighter-rouge">Functor&lt;F&gt;</code> we can apply a function <code class="highlighter-rouge">(A) -&gt; B</code> to <code class="highlighter-rouge">Kind&lt;F, A&gt;</code> and get <code class="highlighter-rouge">Kind&lt;F, B&gt;</code>. We can think of <code class="highlighter-rouge">Kind&lt;F, A&gt;</code> as a structure <code class="highlighter-rouge">S</code> that has a focus <code class="highlighter-rouge">A</code>.
So given a <code class="highlighter-rouge">PSetter&lt;S, T, A, B&gt;</code> we can apply a function <code class="highlighter-rouge">(A) -&gt; B</code> to <code class="highlighter-rouge">S</code> and get <code class="highlighter-rouge">T</code>.</p>

<ul>
  <li><code class="highlighter-rouge">Functor.map(fa: Kind&lt;F, A&gt;, f: (A) -&gt; B) -&gt; Kind&lt;F, B&gt;</code></li>
  <li><code class="highlighter-rouge">PSetter.modify(s: S, f: (A) -&gt; B): T</code></li>
</ul>

<p>You can get a <code class="highlighter-rouge">Setter</code> for any existing <code class="highlighter-rouge">Functor</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.*</span>
<span class="k">import</span> <span class="nn">arrow.optics.*</span>
<span class="k">import</span> <span class="nn">arrow.data.*</span>

<span class="kd">val</span> <span class="py">setter</span><span class="p">:</span> <span class="n">Setter</span><span class="p">&lt;</span><span class="n">ListKOf</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Setter</span><span class="p">.</span><span class="n">fromFunctor</span><span class="p">(</span><span class="n">ListK</span><span class="p">.</span><span class="n">functor</span><span class="p">())</span>
<span class="n">setter</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">).</span><span class="n">k</span><span class="p">(),</span> <span class="m">5</span><span class="p">)</span>
<span class="c1">// ListK(list=[5, 5, 5, 5])</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setter</span><span class="p">.</span><span class="n">modify</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">).</span><span class="n">k</span><span class="p">())</span> <span class="p">{</span> <span class="n">int</span> <span class="p">-&gt;</span> <span class="n">int</span> <span class="p">+</span> <span class="m">1</span> <span class="p">}</span>
<span class="c1">// ListK(list=[2, 3, 4, 5])</span>
</code></pre></div></div>

<p>To create your own <code class="highlighter-rouge">Setter</code> you need to define how to apply <code class="highlighter-rouge">(A) -&gt; B</code> to <code class="highlighter-rouge">S</code>.</p>

<p>A <code class="highlighter-rouge">Setter&lt;Foo, String&gt;</code> can set and modify the value of <code class="highlighter-rouge">Foo</code>. So we need to define how to apply a function <code class="highlighter-rouge">(String) -&gt; String</code> to <code class="highlighter-rouge">Foo</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Foo</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">fooSetter</span><span class="p">:</span> <span class="n">Setter</span><span class="p">&lt;</span><span class="n">Foo</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Setter</span> <span class="p">{</span> <span class="n">f</span><span class="p">:</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">String</span> <span class="p">-&gt;</span>
    <span class="p">{</span> <span class="n">foo</span><span class="p">:</span> <span class="n">Foo</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">fValue</span> <span class="p">=</span> <span class="n">f</span><span class="p">(</span><span class="n">foo</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        <span class="n">foo</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">value</span> <span class="p">=</span> <span class="n">fValue</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">uppercase</span><span class="p">:</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">String</span> <span class="p">=</span> <span class="n">String</span><span class="o">::</span><span class="n">toUpperCase</span>
<span class="n">fooSetter</span><span class="p">.</span><span class="n">modify</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="s">"foo"</span><span class="p">),</span> <span class="n">uppercase</span><span class="p">)</span>
<span class="c1">// Foo(value=FOO)</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">lift</span> <span class="p">=</span> <span class="n">fooSetter</span><span class="p">.</span><span class="n">lift</span><span class="p">(</span><span class="n">uppercase</span><span class="p">)</span>
<span class="n">lift</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="s">"foo"</span><span class="p">))</span>
<span class="c1">// Foo(value=FOO)</span>
</code></pre></div></div>

<h2 id="composition">Composition</h2>

<p>Unlike a regular <code class="highlighter-rouge">set</code> function a <code class="highlighter-rouge">Setter</code> composes. Similar to a <a href="/docs/optics/lens"><code class="highlighter-rouge">Lens</code></a> we can compose <code class="highlighter-rouge">Setter</code>s to focus into nested structures and set or modify a value.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Bar</span><span class="p">(</span><span class="kd">val</span> <span class="py">foo</span><span class="p">:</span> <span class="n">Foo</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">barSetter</span><span class="p">:</span> <span class="n">Setter</span><span class="p">&lt;</span><span class="n">Bar</span><span class="p">,</span> <span class="n">Foo</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Setter</span> <span class="p">{</span> <span class="n">modifyFoo</span> <span class="p">-&gt;</span>
    <span class="p">{</span> <span class="n">bar</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">modifiedFoo</span> <span class="p">=</span> <span class="n">modifyFoo</span><span class="p">(</span><span class="n">bar</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span>
        <span class="n">bar</span><span class="p">.</span><span class="n">copy</span><span class="p">(</span><span class="n">foo</span> <span class="p">=</span> <span class="n">modifiedFoo</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">(</span><span class="n">barSetter</span> <span class="n">compose</span> <span class="n">fooSetter</span><span class="p">).</span><span class="n">modify</span><span class="p">(</span><span class="n">Bar</span><span class="p">(</span><span class="n">Foo</span><span class="p">(</span><span class="s">"some value"</span><span class="p">)),</span> <span class="n">String</span><span class="o">::</span><span class="n">toUpperCase</span><span class="p">)</span>
<span class="c1">// Bar(foo=Foo(value=SOME VALUE))</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Setter</code> can be composed with all optics but <code class="highlighter-rouge">Getter</code> and <code class="highlighter-rouge">Fold</code>. It results in the following optics.</p>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>Iso</th>
      <th>Lens</th>
      <th>Prism</th>
      <th>Optional</th>
      <th>Getter</th>
      <th>Setter</th>
      <th>Fold</th>
      <th>Traversal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Setter</td>
      <td>Setter</td>
      <td>Setter</td>
      <td>Setter</td>
      <td>Setter</td>
      <td>X</td>
      <td>Setter</td>
      <td>X</td>
      <td>Setter</td>
    </tr>
  </tbody>
</table>

<h3 id="polymorphic-setter">Polymorphic setter</h3>

<p>When dealing with polymorphic types we can also have polymorphic setters that allow us to morph the type of the focus.
Previously when we used a <code class="highlighter-rouge">Setter&lt;ListKOf&lt;Int&gt;, Int&gt;</code> it was able to morph the <code class="highlighter-rouge">Int</code> values in the constructed type <code class="highlighter-rouge">ListK&lt;Int&gt;</code>.
With a <code class="highlighter-rouge">PSetter&lt;ListKOf&lt;Int&gt;, ListKOf&lt;String&gt;, Int, String&gt;</code> we can morph an <code class="highlighter-rouge">Int</code> value to a <code class="highlighter-rouge">String</code> value and thus also morph the type from <code class="highlighter-rouge">ListK&lt;Int&gt;</code> to <code class="highlighter-rouge">ListK&lt;String&gt;</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">pSetter</span><span class="p">:</span> <span class="n">PSetter</span><span class="p">&lt;</span><span class="n">ListKOf</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">&gt;,</span> <span class="n">ListKOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">PSetter</span><span class="p">.</span><span class="n">fromFunctor</span><span class="p">(</span><span class="n">ListK</span><span class="p">.</span><span class="n">functor</span><span class="p">())</span>
<span class="n">pSetter</span><span class="p">.</span><span class="k">set</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">).</span><span class="n">k</span><span class="p">(),</span> <span class="s">"Constant"</span><span class="p">)</span>
<span class="c1">// ListK(list=[Constant, Constant, Constant, Constant])</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pSetter</span><span class="p">.</span><span class="n">modify</span><span class="p">(</span><span class="n">listOf</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">4</span><span class="p">).</span><span class="n">k</span><span class="p">())</span> <span class="p">{</span>
    <span class="s">"Value at $it"</span>
<span class="p">}</span>
<span class="c1">// ListK(list=[Value at 1, Value at 2, Value at 3, Value at 4])</span>
</code></pre></div></div>

<h3 id="laws">Laws</h3>

<p>Arrow provides <a href="https://github.com/arrow-kt/arrow/blob/master/arrow-test/src/main/kotlin/arrow/laws/SetterLaws.kt" target="_blank"><code class="highlighter-rouge">SetterLaws</code></a> in the form of test cases for internal verification of lawful instances and third party apps creating their own setters.</p>

