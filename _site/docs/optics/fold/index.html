<h2 id="fold">Fold</h2>

<p>A <code class="highlighter-rouge">Fold</code> is an optic that can see into a structure and get 0 to N foci.
It is a generalisation of an instance of <a href="/docs/typeclasses/foldable"><code class="highlighter-rouge">Foldable</code></a>.</p>

<p>Creating a <code class="highlighter-rouge">Fold</code> can be done by manually defining <code class="highlighter-rouge">foldMap</code>.</p>

<pre><code class="language-kotlin:ank">import arrow.data.*
import arrow.optics.*
import arrow.typeclasses.*
import arrow.instances.*

fun &lt;T&gt; nullableFold(): Fold&lt;T?, T&gt; = object : Fold&lt;T?, T&gt; {
    override fun &lt;R&gt; foldMap(M: Monoid&lt;R&gt;, s: T?, f: (T) -&gt; R): R =
        s?.let(f) ?: M.empty()
}
</code></pre>

<p>Or you can get a <code class="highlighter-rouge">Fold</code> from any existing <code class="highlighter-rouge">Foldable</code>.</p>

<pre><code class="language-kotlin:ank:silent">val nonEmptyIntFold: Fold&lt;NonEmptyListOf&lt;Int&gt;, Int&gt; = Fold.fromFoldable(NonEmptyList.foldable())
</code></pre>

<p><code class="highlighter-rouge">Fold</code> has a similar API as <code class="highlighter-rouge">Foldable</code> but because it’s defined in terms of <code class="highlighter-rouge">foldMap</code> there are no associative fold functions available.</p>

<pre><code class="language-kotlin:ank">nullableFold&lt;Int&gt;().isEmpty(null)
</code></pre>
<pre><code class="language-kotlin:ank">nonEmptyIntFold.combineAll(Int.monoid(), NonEmptyList.of(1, 2, 3))
</code></pre>
<pre><code class="language-kotlin:ank">nullableFold&lt;Int&gt;().headOption(null)
</code></pre>
<pre><code class="language-kotlin:ank">nonEmptyIntFold.headOption(NonEmptyList.of(1, 2, 3, 4))
</code></pre>

<h2 id="composition">Composition</h2>

<p>Composing <code class="highlighter-rouge">Fold</code> can be used for accessing foci in nested structures.</p>

<pre><code class="language-kotlin:ank">val nestedNelFold: Fold&lt;NonEmptyListOf&lt;NonEmptyListOf&lt;Int&gt;&gt;, NonEmptyListOf&lt;Int&gt;&gt; = Fold.fromFoldable(NonEmptyList.foldable())

val nestedNel = NonEmptyList.of(1, 2, 3, 4).map {
    NonEmptyList.of(it, it)
}

(nestedNelFold compose nonEmptyIntFold).getAll(nestedNel)
</code></pre>

<p><code class="highlighter-rouge">Fold</code> can be composed with all optics but <code class="highlighter-rouge">Setter</code> and results in the following optics.</p>

<table>
  <thead>
    <tr>
      <th> </th>
      <th>Iso</th>
      <th>Lens</th>
      <th>Prism</th>
      <th>Optional</th>
      <th>Getter</th>
      <th>Setter</th>
      <th>Fold</th>
      <th>Traversal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>Fold</td>
      <td>X</td>
      <td>Fold</td>
      <td>Fold</td>
    </tr>
  </tbody>
</table>
